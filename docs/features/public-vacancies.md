# Публичные вакансии

Эта заметка описывает процесс публикации вакансий из проектов AdamRMS на публичной странице и их встраивание на внешний сайт.

## Активация публичного списка

1. Перейдите в настройки инстанса и откройте раздел **Публичный сайт**.
2. Включите переключатель **Показывать вакансии** (`enableVacancies`). До тех пор, пока он выключен, `src/public/embed/jobs.php` немедленно прекращает обработку и возвращает сообщение об отключении, поэтому виджет будет пустым.
3. Сохраните изменения и при необходимости обновите кеш CDN или обратного прокси.

> ⚠️ Если вы отключите параметр позднее, все встроенные iframe начнут выводить сообщение об отключении, сохранив безопасность данных.

## Какие роли попадают в виджет

Контроллер `src/public/embed/jobs.php` фильтрует выдачу, поэтому в публичный список попадают только роли, удовлетворяющие всем условиям:

- роль не удалена и отмечена как открытая;
- квота по слотам ещё не исчерпана;
- срок подачи либо отсутствует, либо ещё не прошёл;
- роль не ограничена группами доступа (`projectsVacantRoles_visibleToGroups` пустой);
- роль разрешена к публикации (`projectsVacantRoles_showPublic = 1`);
- проект активен, относится к текущему инстансу и не удалён/не архивирован.

Это гарантирует, что на витрину не попадут внутренние, закрытые или устаревшие позиции.

## Отображение клиентов и контактных данных

1. Чтобы включить колонку с клиентом проекта, активируйте настройку **Показывать клиента вакансии** (`showVacancyClients`) в блоке публичных настроек инстанса. После сохранения колонка будет показана как в таблице, так и в карточках мобильной верстки.
2. Контактные данные руководителя проекта (ФИО и email) подгружаются автоматически: скрипт получает менеджера проекта и делает его доступным в шаблоне `jobsPublic.twig`. При необходимости:
   - добавьте вывод адреса электронной почты в шаблоне (`role.users_email`),
   - или скройте его, если публикация email не соответствует политике конфиденциальности.
3. Для дополнительной информации клиентов можно расширить шаблон Twig, подключив кастомный блок в `public/embed/templatePublic.twig`.

## Работа с вопросами кандидату

- В карточке роли хранится поле `projectsVacantRoles_questions` (JSON). Контроллер загружает его и передаёт в шаблон, поэтому вы можете дополнительно вывести вопросы в модальном окне или отдельном блоке.
- Чтобы обновить список вопросов, отредактируйте роль в интерфейсе AdamRMS → вкладка вакансий.
- Рекомендуется использовать закрытые вопросы и текстовые поля, не требующие передачи чувствительных данных.

## Примеры использования

### Встраивание виджета на сайт

```html
<iframe
  src="https://example.adamrms.com/public/embed/jobs.php?instance=my-instance"
  title="Вакансии AdamRMS"
  loading="lazy"
  style="width:100%;min-height:700px;border:0;">
</iframe>
```

- Параметр `instance` обязателен, если публикации включены для нескольких инстансов на одном домене.
- Дополнительно можно обернуть iframe в контейнер с адаптивными пропорциями, чтобы сохранить отзывчивость.

### Брендирование Twig-шаблонов

1. Скопируйте шаблоны `src/public/embed/templatePublic.twig` и `src/public/embed/jobsPublic.twig` в пользовательский каталог темы.
2. Настройте цвета, шрифты и лого в блоках `styles` и `header`.
3. Подключите переопределённые шаблоны через Twig Loader (см. `config/twig.php`) или положите их в путь, который загружает `$TWIG` раньше оригинала.
4. Не меняйте структуру данных — контроллер ожидает переменные `roles`, `showClients`, `CONFIG`.

### Мониторинг откликов

1. Все отклики собираются на странице `project/crew/vacancies.php` внутри AdamRMS.
2. Используйте фильтры по проекту и статусу, чтобы отслеживать новые заявки.
3. Для метрик откликов включите уведомления по email или webhook-интеграции в настройках инстанса.

## Безопасность и ограничения доступа

- Публикуйте только те проекты, которые могут быть раскрыты публично, и проверяйте, что у роли нет привязки к закрытым группам.
- Перед включением `enableVacancies` убедитесь, что в описаниях нет персональных данных клиентов или внутренних ссылок.
- Права доступа на редактирование вакансий остаются ограниченными интерфейсом AdamRMS; публичный виджет только читает данные.
- Убедитесь, что веб-сайт, куда встраивается iframe, обслуживается по HTTPS и соответствует вашей политике конфиденциальности.
- Регулярно проверяйте список опубликованных ролей, чтобы своевременно закрывать устаревшие позиции.
